{% extends 'layout.html' %}
{% load markdownify %}

{% block title %}
    Resume
{% endblock %}

{% block content %}
    <div class="container-scroller">
        <!-- partial:partials/_sidebar.html -->
        {% include 'dashboard/includes/navbar.html' %}
        <!-- partial -->
        <div class="container-fluid page-body-wrapper">
            <!-- partial:partials/_navbar.html -->
            {% include 'dashboard/includes/header.html' %}
            <!-- partial -->
            <div class="main-panel">
                <div class="content-wrapper">
                    <form method="POST" action="{% url 'resume' %}" class="bg-dark text-white p-4 rounded">
                        {% csrf_token %}
                        <h4 class="mb-3">Add Your Skills</h4>

                        {# --- New Personal Information Fields --- #}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="first_name" class="form-label">First Name</label>
                                <input type="text" class="form-control text-light"
                                       id="first_name" name="first_name" placeholder="Enter your first name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="last_name" class="form-label">Last Name</label>
                                <input type="text" class="form-control text-light"
                                       id="last_name" name="last_name" placeholder="Enter your last name" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control text-light"
                                       id="email" name="email" placeholder="Enter your email address" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone_number" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control text-light"
                                       id="phone_number" name="phone_number" placeholder="Enter your phone number">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="linkedin_url" class="form-label">LinkedIn Profile URL (Optional)</label>
                            <input type="url" class="form-control text-light"
                                   id="linkedin_url" name="linkedin_url"
                                   placeholder="e.g., https://linkedin.com/in/yourprofile">
                        </div>

                        <div class="mb-4">
                            <label for="portfolio_url" class="form-label">Portfolio/Website URL (Optional)</label>
                            <input type="url" class="form-control text-light"
                                   id="portfolio_url" name="portfolio_url"
                                   placeholder="e.g., https://yourportfolio.com">
                        </div>
                        <hr class="border-secondary my-4">
                        {# --- End of New Personal Information Fields --- #}

                        <div class="input-group mb-3">
                            <input type="text" class="form-control text-light" id="skillInput"
                                   placeholder="Enter a skill">
                            <button class="btn btn-primary" type="button" id="addSkillBtn">Add</button>
                        </div>

                        <ul class="row mb-3" id="skillsList">
                            <!-- Added skills will appear here -->
                        </ul>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description (optional)</label>
                            <textarea class="form-control text-light" name="description" id="description" rows="3"
                                      placeholder="Write something about yourself..."></textarea>
                        </div>

                        <input type="hidden" name="skills" id="skillsHiddenInput">

                        <button type="submit" class="btn btn-success">Submit</button>
                    </form>
                    <br>

                    {% if message %}
                        <div class="flex-grow overflow-auto mb-3"
                             style="background-color: #2a2d34; border-radius: 8px; padding: 10px;">
                            <div class="d-flex flex-column">
                                <div class="align-self-start bg-primary text-white rounded p-2 mb-2"
                                     style="max-width: 100%;">
                                    {{ message|markdownify }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <br>
                    <br>
                    {% if message %}
                        <div class="mt-3">
                            <a href="{% url 'download_generated_resume_pdf' %}"
                               class="btn btn-outline-danger me-2" target="_blank">
                                <i class="mdi mdi-file-pdf-box"></i> Download as PDF
                            </a>
                            <a href="{% url 'download_generated_resume_word' %}"
                               class="btn btn-outline-primary" target="_blank">
                                <i class="mdi mdi-file-word-box"></i> Download as Word
                            </a>
                        </div>
                    {% endif %}
                    <script>
                        const addSkillBtn = document.getElementById('addSkillBtn');
                        const skillInput = document.getElementById('skillInput');
                        const skillsList = document.getElementById('skillsList');
                        const skillsHiddenInput = document.getElementById('skillsHiddenInput');

                        let skills = [];

                        addSkillBtn.addEventListener('click', () => {
                            const skill = skillInput.value.trim();
                            if (skill && !skills.includes(skill)) {
                                skills.push(skill);

                                const li = document.createElement('li');
                                li.className = 'd-flex justify-content-between align-items-center p-3 rounded border border-success border-3 bg-none text-white col-lg-3';
                                li.textContent = skill;

                                const removeBtn = document.createElement('button');
                                removeBtn.className = 'btn btn-sm btn-danger';
                                removeBtn.textContent = 'Remove';
                                removeBtn.onclick = () => {
                                    skills = skills.filter(s => s !== skill);
                                    skillsList.removeChild(li);
                                    updateHiddenInput();
                                };

                                li.appendChild(removeBtn);
                                skillsList.appendChild(li);

                                updateHiddenInput();
                                skillInput.value = '';
                            }
                        });

                        function updateHiddenInput() {
                            skillsHiddenInput.value = skills.join(',');
                        }
                    </script>

                </div>
                <!-- content-wrapper ends -->
                <!-- partial:partials/_footer.html -->
                {% include 'dashboard/includes/footer.html' %}
                <!-- partial -->
            </div>
            <!-- main-panel ends -->
        </div>
        <!-- page-body-wrapper ends -->
    </div>

{% endblock %}




